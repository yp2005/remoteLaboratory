version: '2'
services:

  mysql:
    image: mysql:5.7.17
    ports:
      - 3306:3306
    volumes:
      - ${MYSQL_DATA}:/var/lib/mysql
      - /etc/localtime:/etc/localtime:ro
    environment:
      - MYSQL_ROOT_PASSWORD=root
      - MYSQL_DATABASE=LABORATORY
      - MYSQL_USER=laboratory
      - MYSQL_PASSWORD=laboratory
    command: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci --innodb-buffer-pool-size=5368709120 --innodb_buffer_pool_chunk_size=671088640 --max_allowed_packet=1073741824
#    networks:
#      app_net:
#        ipv4_address: 10.10.10.1

  redis:
    image: redis:5-alpine

    ports:
      - 6379:6379
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${REDIS_DATA}:/data

    command: redis-server --appendonly yes
#    networks:
#      app_net:
#        ipv4_address: 10.10.10.2
    depends_on:
      - mysql
  webserver:
    image: public/java
    ports:
      - 8000:8000
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${UPLOAD_DATA}:/static/upload
      - ${LOG_DIR}:/log
    volumes_from:
      - remoteLaboratory
    command: ["/wait-for.sh","redis:6379","-t","120","--","java","-Xmx128M","-Djava.security.egd=file:/dev/./urandom","-Dlogging.file=/log/app.log","-Dlogging.level=debug","-jar","/app/remoteLaboratory.jar"]
    environment:
      - SPRING_PROFILES_ACTIVE=docker
    depends_on:
      - redis
#    networks:
#      app_net:
#        ipv4_address: 10.10.10.3
  remoteLaboratory:
    image: public/remote_laboratory:1.0-SNAPSHOT
    volumes:
      - /app


